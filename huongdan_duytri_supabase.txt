HÆ°á»›ng dáº«n cÃ i Ä‘áº·t:
1. Táº¡o báº£ng trong Supabase
Cháº¡y SQL nÃ y trong Supabase SQL Editor:
sqlCREATE TABLE duy_tri (
  id BIGSERIAL PRIMARY KEY,
  timestamp TIMESTAMPTZ DEFAULT NOW(),
  note TEXT
);
2. ThÃªm GitHub Secrets
VÃ o repository â†’ Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret
ThÃªm 2 secrets:

SUPABASE_URL: URL Supabase cá»§a báº¡n (dáº¡ng https://xxx.supabase.co)
SUPABASE_KEY: Anon/Service key tá»« Supabase

3. Táº¡o file workflow
Táº¡o file .github/workflows/maintain-supabase.yml vá»›i ná»™i dung tá»« artifact trÃªn.
4. KÃ­ch hoáº¡t

Action sáº½ tá»± Ä‘á»™ng cháº¡y má»—i 5 ngÃ y
Báº¡n cÅ©ng cÃ³ thá»ƒ cháº¡y thá»§ cÃ´ng tá»« tab Actions â†’ chá»n workflow â†’ Run workflow

CÃ¡ch hoáº¡t Ä‘á»™ng:

âœ… Má»—i 5 ngÃ y, action sáº½ cháº¡y
ğŸ“Š Äáº¿m sá»‘ dÃ²ng trong báº£ng duy_tri
ğŸ—‘ï¸ Náº¿u â‰¥ 100 dÃ²ng â†’ xÃ³a táº¥t cáº£
â• ThÃªm 1 dÃ²ng má»›i vá»›i timestamp
ğŸ”„ Database Ä‘Æ°á»£c duy trÃ¬, trÃ¡nh bá»‹ khÃ³a

LÆ°u Ã½: Lá»‹ch trÃ¬nh 5 ngÃ y Ä‘áº£m báº£o an toÃ n cho giá»›i háº¡n 7 ngÃ y cá»§a Supabase free tier!


Code =================
name: Duy trÃ¬ Supabase Database

on:
  schedule:
    # Cháº¡y má»—i 5 ngÃ y vÃ o lÃºc 0:00 UTC
    - cron: '0 0 */5 * *'
  workflow_dispatch: # Cho phÃ©p cháº¡y thá»§ cÃ´ng

jobs:
  maintain-database:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install @supabase/supabase-js

      - name: Maintain database
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        run: |
          node - <<'EOF'
          const { createClient } = require('@supabase/supabase-js');
          
          const supabase = createClient(
            process.env.SUPABASE_URL,
            process.env.SUPABASE_KEY
          );
          
          async function maintain() {
            try {
              // 1. Äáº¿m sá»‘ dÃ²ng hiá»‡n táº¡i
              const { count, error: countError } = await supabase
                .from('duy_tri')
                .select('*', { count: 'exact', head: true });
              
              if (countError) throw countError;
              
              console.log(`Sá»‘ dÃ²ng hiá»‡n táº¡i: ${count}`);
              
              // 2. Náº¿u Ä‘á»§ 100 dÃ²ng thÃ¬ xÃ³a háº¿t
              if (count >= 100) {
                console.log('ÄÃ£ Ä‘á»§ 100 dÃ²ng, báº¯t Ä‘áº§u xÃ³a...');
                const { error: deleteError } = await supabase
                  .from('duy_tri')
                  .delete()
                  .neq('id', 0); // XÃ³a táº¥t cáº£
                
                if (deleteError) throw deleteError;
                console.log('ÄÃ£ xÃ³a táº¥t cáº£ dá»¯ liá»‡u');
              }
              
              // 3. ThÃªm 1 dÃ²ng má»›i
              const { data, error: insertError } = await supabase
                .from('duy_tri')
                .insert([
                  { 
                    timestamp: new Date().toISOString(),
                    note: 'Auto maintenance'
                  }
                ])
                .select();
              
              if (insertError) throw insertError;
              
              console.log('ÄÃ£ thÃªm dÃ²ng má»›i:', data);
              console.log('âœ… Duy trÃ¬ database thÃ nh cÃ´ng!');
              
            } catch (error) {
              console.error('âŒ Lá»—i:', error.message);
              process.exit(1);
            }
          }
          
          maintain();
          EOF
